{% extends "default.html" %}
{% load static %}
{% block extrastyle %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.0/vis.min.css" type="text/css"/>
{% endblock %}

{% block content %}

    {% if selectedName %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.0/vis.min.js"></script>


    <div class="container">
        <div class="row">
            <div class="col s12 ">
                <h4>{{ selectedName }}</h4>
            </div>
            <div class="col s12 ">
                <div id="PhDnetwork"></div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="container">
        <div class="row">
            <div class="col s12">
                <h3>There is nobody here!  Try <a href="/people/">searching!</a></h3>
            </div>
        </div>
    </div>
    {% endif %}

{% endblock %}

{% block javascript_doc_ready %}
    <script type="text/javascript">

    // create a network
    var container = document.getElementById('PhDnetwork');
    var nodes = new vis.DataSet({{ nodes|safe }})
    var edges = new vis.DataSet({{ edges|safe }})
    // provide the data in the vis format
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        nodes : {
            shape: 'dot',
            size: 10
        }
    };

    // initialize your network!
    var network = new vis.Network(container, data, options);
    network.on("click", function( params ) {
        $.getJSON("/get_network_JSON/" + params.nodes + "/", function( data ){
                nodesObj=JSON.parse(data.nodes);
                edgesObj=JSON.parse(data.edges);

                $.each(nodesObj, function(n){
                    if(nodes.get(nodesObj[n].id)){} else {
                        nodes.add(nodesObj[n]);
                    }
                });

                $.each(edgesObj, function(e) {
                    var edgeExists = edges.get({
                        filter: function (item) {
                            return item.from == edgesObj[e].from && item.to == edgesObj[e].to;
                        }
                    });
                    console.log(edgeExists);
                    if(edgeExists.length > 0){
                        //do nothing
                    }else{
                        edges.add(edgesObj[e]);
                    }
                });

                //console.log(edges.getIds());
                //edges.update(JSON.parse(data.edges))
        });
    });
    Materialize.toast("You can click on a node to expand it.", 3000);
    setTimeout(function(){
         Materialize.toast("You can drag nodes to change the layout.", 3000);
    }, 3700);
</script>
{% endblock %}